<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <title>writeup | redecorate.lol</title>
    <style>
        .back-link {
            display: inline-block;
            margin-bottom: 30px;
            color: #a6adc8;
            text-decoration: none;
            font-size: 0.9rem;
        }
        .back-link:hover { color: #f5c2e7; text-decoration: underline; }

        .writeup-header { text-align: left; border-bottom: 1px solid #313244; padding-bottom: 30px; margin-bottom: 40px; }
        .writeup-title { font-size: 2rem; font-weight: 400; margin-bottom: 15px; color: #cdd6f4; }
        .writeup-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 0.9rem; color: #7f849c; }
        .meta-item { display: flex; align-items: center; gap: 8px; }
        .lang-icons { display: inline-flex; align-items: center; gap: 10px; }
        .lang-icon { width: 20px; height: 20px; vertical-align: middle; }

        nav.toc { background: #181825; border: 1px solid #45475a; border-radius: 4px; padding: 20px; margin: 30px 0; }
        nav.toc h3 { color: #cdd6f4; margin-bottom: 12px; font-size: 1.1rem; }
        nav.toc ul { list-style: none; padding: 0; margin: 0; }
        nav.toc li { margin-bottom: 8px; }
        nav.toc a { color: #a6adc8; text-decoration: none; font-size: 0.95rem; }
        nav.toc a:hover { color: #f5c2e7; text-decoration: underline; }

        .writeup-content h2 { font-size: 1.4rem; font-weight: 500; margin: 40px 0 16px; color: #cdd6f4; padding-bottom: 8px; border-bottom: 1px solid #313244; }
        .writeup-content p { margin-bottom: 16px; color: #bac2de; line-height: 1.7; }
        .writeup-content li { color: #bac2de; line-height: 1.6; }

        .code-block { background: #181825; border: 1px solid #45475a; border-radius: 6px; margin: 16px 0; overflow: hidden; }
        .code-header { display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: #313244; border-bottom: 1px solid #45475a; color: #a6adc8; font-size: 0.9rem; font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace; }
        .code-icon { width: 18px; height: 18px; }
        .code-block pre { margin: 0; padding: 16px; overflow-x: auto; color: #cdd6f4; }
        .code-block code { font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace; }

        .writeup-footer { margin-top: 50px; padding-top: 30px; border-top: 1px solid #313244; text-align: center; }
        .writeup-footer p { font-size: 0.9rem; color: #7f849c; margin: 0; }

        @media (max-width: 768px) {
            .writeup-title { font-size: 1.6rem; }
            .writeup-meta { flex-direction: column; gap: 8px; }
            .writeup-content h2 { font-size: 1.3rem; }
        }
        /*syntax highlighting*/
        .token.comment { color: #6c7086; font-style: italic; }
        .token.keyword { color: #f5c2e7; }
        .token.string { color: #a6e3a1; }
        .token.number { color: #fab387; }
        .token.function { color: #89b4fa; }
        .token.type, .token.builtin { color: #f9e2af; }
        .token.operator { color: #94e2d5; }
        .token.punctuation { color: #9399b2; }
    </style>
</head>
<body>
    <div class="container">
        <main class="main">
            <a href="../" class="back-link">← back to main site</a>

            <header class="writeup-header">
                <h1 class="writeup-title">Kittycrypt Challenge</h1>
                <div class="writeup-meta">
                    <div class="meta-item"><span class="lang-icons"><img src="../images/go-icon.svg" class="lang-icon" alt="Go" title="Go"/><img src="../images/python-icon.svg" class="lang-icon" alt="Python" title="Python"/></span></div>
                </div>
            </header>

            <nav class="toc">
                <h3>Table of Contents</h3>
                <ul>
                    <li><a href="#section1">the problem</a></li>
                    <li><a href="#section2">solving the obfuscation</a></li>
                    <li><a href="#section3">afterword</a></li>
                </ul>
            </nav>

            <article class="writeup-content">
                <section id="section1">
                    <h2>the problem</h2>
                    <p>in this file:</p>
                    <div class="code-block">
                        <div class="code-header"><img class="code-icon" src="../images/go-icon.svg" alt="Go" title="Go"/> main.go</div>
                        <pre><code class="language-go">package main

import (
    *snip*
)

var CharSet = map[rune]string{
    *snip*
}

func catify(input string, keys []int) string {
	var keyedText string
	var result string
	for i, char := range input {
		keyedText += string(rune(int(char) + keys[i]))
	}
	fmt.Printf("I2Keyed: %s\n", keyedText)
	hexEncoded := strings.ToUpper(hex.EncodeToString([]byte(keyedText)))
	fmt.Printf("K2Hex: %s\n", hexEncoded)

	for _, rune := range hexEncoded {
		result += CharSet[rune]
	}
	return result
}

func savePair(name, input, output string) {
	inputFile, err := os.OpenFile(name+"_input.txt", os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0644)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer inputFile.Close()
	outputFile, err := os.OpenFile(name+"_output.txt", os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0644)
	if err != nil {
		fmt.Println(err)
		return
	}
	defer outputFile.Close()
	if _, err := inputFile.Write([]byte(input)); err != nil {
		fmt.Println(err)
		return
	}
	if _, err := outputFile.Write([]byte(output)); err != nil {
		fmt.Println(err)
		return
	}
}

func getKeys(length int) []int {
	var keys = []int{}
	keyFileName := fmt.Sprintf("keys_%d.json", length)
	file, err := os.Open(keyFileName)
	if err != nil {

		for i := 0; i < length; i++ {
			num, _ := rand.Int(rand.Reader, big.NewInt(60000))
			keys = append(keys, int(num.Int64()))
		}
		keyFile, err := os.OpenFile(keyFileName, os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0644)
		if err != nil {
			fmt.Println(err)
			return []int{}
		}
		defer keyFile.Close()
		encoded, _ := json.Marshal(keys)
		keyFile.Write(encoded)
		return keys
	}
	json.NewDecoder(file).Decode(&keys)
	return keys
}

func main() {
	input := "You fools! You will never get my catnip!!!!!!!"
	keys := getKeys(len(input))
	encoded := catify(input, keys)
	savePair("example", input, encoded)
}
</code></pre>
                    </div>
                    <p>
                        a message is obfuscated through a series of character value shifts. Each character is shifted using a set of random key values, then hex-encoded, and finally mapped to emojis. while it hides the original text, it lacks actual cryptographic security.
                    </p>
                </section>

                <section id="section2">
                    <h2>solving the obfuscation</h2>
                    <p>to reverse the encoding, we need to undo each transformation step.</p>
                    <div class="code-block">
                        <div class="code-header"><img class="code-icon" src="../images/python-icon.svg" alt="Python" title="Python"/> solve.py</div>
                        <pre><code class="language-python">*snip*

def emojis_to_hex(ciphertext_emoji: str) -> str:
    return pattern.sub(lambda m: emoji_to_hex_map[m.group()], ciphertext_emoji)


def hex_to_keyed_text(hex_string: str) -> str:
    return binascii.unhexlify(hex_string).decode('utf-8')


# use known plaintext before the obsfucation 
example_hex = emojis_to_hex(example_cipher_emoji)
example_keyed_text = hex_to_keyed_text(example_hex)
keys = [ord(k) - ord(p) for p, k in zip(plaintext, example_keyed_text)]

# find the flag
flag_hex = emojis_to_hex(flag_cipher_emoji)
flag_keyed_text = hex_to_keyed_text(flag_hex)
flag_plaintext = ''.join([chr(ord(k) - key) for k, key in zip(flag_keyed_text, keys)])

print("recovered keys:", keys)
print("flag:", flag_plaintext)</code></pre>
                    </div>
                    <p>
                        firstly, we map the emojis back to their corresponding hex values. then, we convert the hex back into an intermediate "keyed" text. since we have that known plaintext example, we can determine the character shift values used in the encoding. with the keys, we subtract the shifts from the encoded flag text to determine the original message. The lack of cryptographic security makes this decryption easy, once the pattern is identified, reversing it is just a matter of applying character operations.
                    </p>
                </section>

                <section id="section3">
                    <h2>afterword</h2>
                    <p>
                        this write-up was done in part for IRISCTF 2025. It was a fun challenge that required a mix of cryptography, reverse engineering, and programming skills.
                    </p>
                    <p>
                        the decoding process demonstrated here emphasizes the limitations of security through obscurity, and that simpler, isn't always better.
                    </p>
                    <p>
                        i hope this write-up brought you insight into the "complexity" of string obfuscation algorithms and how easily some of them can be defeated.
                    </p>
                </section>
            </article>

            <footer class="writeup-footer">
                <p><strong>disclaimer:</strong> this writeup is for educational purposes only.</p>
            </footer>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-bottom">
                    <a href="../" class="back-link">← back to main site</a>
                    <div class="footer-bottom-inner">
                        <div class="copyright-line">
                            <p>&copy; 2025 redecorate.lol</p>
                            <p>V2.0 - 17/08/2025</p>
                        </div>
                        <p id="footer-quote"></p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>
<script src="../script.js" defer></script>
<script>
(function(){
    function htmlEscape(s){
        return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g,'&gt;');
    }

    function protect(text, regex, type, placeholders){
        return text.replace(regex, function(m){
            var id = placeholders.length;
            placeholders.push('<span class="token ' + type + '">' + htmlEscape(m) + '</span>');
            return '___PLACEHOLDER_'+id+'___';
        });
    }

    function restorePlaceholders(s, placeholders){
        return s.replace(/___PLACEHOLDER_(\d+)___/g, function(_, i){ return placeholders[Number(i)] || _; });
    }

    function wrapWords(s, words, cls){
        if (!words.length) return s;
        var pattern = new RegExp('\\b(' + words.map(function(w){return w.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&');}).join('|') + ')\\b', 'g');
        return s.replace(pattern, '<span class="token ' + cls + '">$1</span>');
    }

    function wrapRegex(s, regex, cls){
        return s.replace(regex, '<span class="token ' + cls + '">$1</span>');
    }

    function highlightPython(src){
        var placeholders = [];
        var t = src;
        t = protect(t, /"""[\s\S]*?"""|'''[\s\S]*?'''/g, 'string', placeholders);
        t = protect(t, /"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'/g, 'string', placeholders);
        t = protect(t, /#.*$/gm, 'comment', placeholders);

        // escape, then highlight keywords/numbers/functions
        var e = htmlEscape(t);
        e = wrapWords(e, [
            'and','as','assert','break','class','continue','def','del','elif','else','except','False','finally','for','from','global','if','import','in','is','lambda','None','nonlocal','not','or','pass','raise','return','True','try','while','with','yield'
        ], 'keyword');
        e = e.replace(/\b(0x[0-9a-fA-F]+|\d+(?:\.\d+)?(?:e[+\-]?\d+)?)\b/g, '<span class="token number">$1</span>');
        e = e.replace(/\b([A-Za-z_]\w*)\s*(?=\()/g, '<span class="token function">$1</span>');

        // restore strings/comments
        return restorePlaceholders(e, placeholders);
    }

    function highlightGo(src){
        var placeholders = [];
        var t = src;
        // protect comments and strings first
        t = protect(t, /\/\*[\s\S]*?\*\//g, 'comment', placeholders);
        t = protect(t, /\/\/.*$/gm, 'comment', placeholders);
        t = protect(t, /`[\s\S]*?`/g, 'string', placeholders);
        t = protect(t, /"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])+'/g, 'string', placeholders);

        var e = htmlEscape(t);
        e = wrapWords(e, [
            'break','case','chan','const','continue','default','defer','else','fallthrough','for','func','go','goto','if','import','interface','map','package','range','return','select','struct','switch','type','var'
        ], 'keyword');
        e = wrapWords(e, [
            'bool','string','int','int8','int16','int32','int64','uint','uint8','uint16','uint32','uint64','uintptr','byte','rune','float32','float64','complex64','complex128','error'
        ], 'type');
        e = e.replace(/\b(0x[0-9a-fA-F]+|\d+(?:\.\d+)?(?:e[+\-]?\d+)?)\b/g, '<span class="token number">$1</span>');
        e = e.replace(/\bfunc\s+([A-Za-z_]\w*)/g, 'func <span class="token function">$1</span>');

        return restorePlaceholders(e, placeholders);
    }

    function highlightElement(code){
        var lang = '';
        for (var i=0;i<code.classList.length;i++){
            var cls = code.classList[i];
            if (cls.indexOf('language-') === 0) { lang = cls.slice(9); break; }
        }
        var src = code.textContent;
        var out = src;
        if (lang === 'python' || lang === 'py') out = highlightPython(src);
        else if (lang === 'go' || lang === 'golang') out = highlightGo(src);
        else out = htmlEscape(src);
        code.innerHTML = out;
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function(){
            document.querySelectorAll('.code-block pre code').forEach(highlightElement);
        });
    } else {
        document.querySelectorAll('.code-block pre code').forEach(highlightElement);
    }
})();
</script>
</html>
